; ============================================================
; HALMET Marine Engine & Tank Monitor
; PlatformIO project configuration
;
; IMPORTANT — platform note:
;   SensESP v3 requires Arduino ESP32 Core 3.x (IDF 5.x).
;   The official PlatformIO espressif32 platform is frozen at
;   Core 2.0.17 and will NOT build SensESP v3.
;   We therefore use the community pioarduino fork, exactly as
;   recommended by the SensESP project itself.
;
; IMPORTANT — NMEA2000 library name:
;   The PlatformIO registry name is  ttlappalainen/NMEA2000-library
;   (hyphen, not slash).  The old name  ttlappalainen/NMEA2000  does
;   not exist in the registry and causes UnknownPackageError.
;   Version spec uses the library's date-based scheme, e.g. ^4.21.0
;
; IMPORTANT — NMEA2000_esp32:
;   The CAN/TWAI driver for the ESP32 is NOT in the PlatformIO
;   registry.  Pull it directly from GitHub.
; ============================================================

[env:halmet]
; pioarduino "stable" tag always points to the latest tested release
platform  = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
board     = esp32dev
framework = arduino

monitor_speed  = 115200
upload_speed   = 921600

; HALMET has 8 MB flash — use the 8 MB partition table for larger OTA headroom
board_build.partitions = default_8MB.csv

build_flags =
    -D ARDUINO_USB_CDC_ON_BOOT=0
    ; SensESP v3 requires the ESP-IDF logging backend
    -D USE_ESP_IDF_LOG
    -D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_WARN
    ; --- HALMET physical pin assignments ---
    -D HALMET_PIN_D1=23       ; Alternator W-terminal (RPM pulse input)
    -D HALMET_PIN_D2=25       ; Oil pressure warning  (active-low)
    -D HALMET_PIN_D3=27       ; Temperature warning   (active-low)
    -D HALMET_PIN_D4=26       ; Ignition key sense    (optional, +12V)
    -D HALMET_PIN_1WIRE=4     ; DS18B20 1-Wire bus
    -D HALMET_PIN_RELAY=32    ; Bilge fan relay output (GPIO header)
    ; --- ADS1115 I2C address (ADDR pin to GND → 0x48) ---
    -D ADS1115_ADDRESS=0x48
    ; --- NMEA 2000 CAN pins (HALMET fixed: TX=5, RX=4) ---
    -D ESP32_CAN_TX_PIN=GPIO_NUM_5
    -D ESP32_CAN_RX_PIN=GPIO_NUM_4

lib_deps =
    ; SensESP v3 — must be ^3.1.0 or later for pioarduino/IDF5 compatibility
    SignalK/SensESP @ ^3.1.0
    ; NMEA2000 core library — registry name has a HYPHEN, not a slash
    ttlappalainen/NMEA2000-library
    ; NMEA2000 ESP32 TWAI/CAN driver — not in registry, pull from GitHub
    https://github.com/ttlappalainen/NMEA2000_esp32.git
    ; Sensors
    paulstoffregen/OneWire @ ^2.3
    milesburton/DallasTemperature @ ^3.9
    adafruit/Adafruit ADS1X15 @ ^2.5
